<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>G.R.O.W Growing Degree Days</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .highlight {
      color: #8bb439 !important;
    }
    .bg-highlight {
      background-color: #8bb439 !important;
      color: #fff !important;
    }
    .card-title {
      font-size: 1rem;
      font-weight: 500;
    }
    .card-value {
      font-size: 2rem;
      font-weight: bold;
      color: #222;
    }
    .badge-info {
      background: #e6f4d7;
      color: #8bb439;
      font-size: 0.8em;
    }
    .info-icon {
      font-size: 1.1em;
      color: #8bb439;
      cursor: pointer;
      vertical-align: middle;
    }
    .expand-icon {
      transition: transform 0.3s ease;
    }
    .expand-icon.collapsed {
      transform: rotate(-90deg);
    }
    .text-success {
      color: #8bb439 !important;
    }
    .btn-outline-success {
      color: #8bb439 !important;
      border-color: #8bb439 !important;
    }
    .btn-outline-success:hover {
      background-color: #8bb439 !important;
      color: #fff !important;
    }
    .bg-success {
      background-color: #8bb439 !important;
    }
    .btn-main-green {
      background-color: #8bb439 !important;
      border-color: #8bb439 !important;
      color: #fff !important;
    }
    .btn-main-green:hover, .btn-main-green:focus {
      background-color: #7aa32f !important;
      border-color: #7aa32f !important;
      color: #fff !important;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <!-- Header -->
    <div class="mb-3 p-4 bg-white rounded-4 shadow-sm">
      <h2 class="mb-1 fw-bold">Growing Degree Days</h2>
      <p class="text-muted mb-0">Use growing degree days to anticipate pest and disease development, optimize biofix timing, and improve risk management decisions for your crops.</p>
    </div>

    <!-- Introduction Section -->
    <div class="mb-4 bg-white p-4 rounded-4 shadow-sm">
      <div class="d-flex align-items-center mb-2">
        <h5 class="mb-0 fw-bold">How to Use This Tool</h5>
        <button class="btn btn-sm btn-outline-secondary ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#introCollapse" aria-expanded="false" aria-controls="introCollapse">
          <span class="material-icons expand-icon collapsed">expand_more</span>
        </button>
      </div>
      <div class="collapse" id="introCollapse">
        <div class="row">
          <div class="col-md-6 mb-3">
            <h6 class="fw-bold text-success">What are Growing Degree Days (GDD)?</h6>
            <p class="text-muted small mb-2">GDD measure heat accumulation above a base temperature to predict pest and disease development. Each pest has specific GDD thresholds for different life stages.</p>
          </div>
          <div class="col-md-6 mb-3">
            <h6 class="fw-bold text-success">How to Interpret the Data</h6>
            <ul class="text-muted small mb-0">
              <li><strong>Current Growth Stage:</strong> Shows where your pest is in its development cycle</li>
              <li><strong>All Growth Stages:</strong> Expand to see the complete progression</li>
              <li><strong>Chart:</strong> Visualizes GDD accumulation over time</li>
              <li><strong>Risk Level:</strong> Indicates infection risk based on current conditions</li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <h6 class="fw-bold text-success">Setting Up Your Analysis</h6>
            <ol class="text-muted small mb-0">
              <li><strong>Select Farm/Paddock:</strong> Choose your location</li>
              <li><strong>Choose Pest/Disease:</strong> Select the specific pest you're monitoring</li>
              <li><strong>Set Biofix Date:</strong> <span class="text-success fw-bold">CRITICAL</span> - Enter the date when pest activity first began (e.g., first adult emergence). This is the starting point for all GDD calculations.</li>
            </ol>
          </div>
          <div class="col-md-6 mb-3">
            <h6 class="fw-bold text-success">Making Management Decisions</h6>
            <ul class="text-muted small mb-0">
              <li>Use the <strong>Current Stage</strong> to time treatments</li>
              <li>Monitor <strong>Risk Level</strong> for treatment urgency</li>
              <li>Check <strong>Biological Recommendations</strong> for product suggestions</li>
              <li>Review the <strong>Chart</strong> to see development trends</li>
            </ul>
          </div>
        </div>
        <div class="alert alert-info mt-3 mb-0">
          <div class="d-flex align-items-start">
            <span class="material-icons me-2">info</span>
            <div class="small">
              <strong>Pro Tip:</strong> <span class="fw-bold">The biofix date is the most critical setting</span> - this determines when GDD accumulation begins and affects all predictions. Set your biofix date accurately based on when you first observed the pest or when a specific biological event occurred (like first adult emergence or first egg laying). Click the "How to Set" button next to the biofix field for detailed guidance.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters (Farm/Paddock, GDD Base, Pest, Biofix) -->
    <div class="mb-4 bg-white p-3 rounded-4 shadow-sm d-flex flex-wrap gap-2 align-items-center">
      <label for="farmSelect" class="form-label mb-0 me-2">Farm:</label>
      <select id="farmSelect" class="form-select w-auto me-3">
        <option value="1">Nutrition Farms Yandina</option>
        <option value="2">South Farm</option>
      </select>
      <label for="paddockSelect" class="form-label mb-0 me-2">Paddock:</label>
      <select id="paddockSelect" class="form-select w-auto me-3">
        <option value="1">Ginger Paddock</option>
      </select>
      <label for="pestSelect" class="form-label mb-0 me-2">Pest/Disease:</label>
      <select id="pestSelect" class="form-select w-auto me-3">
        <option value="ascospore">Apple Scab</option>
        <option value="other">Other Pest</option>
      </select>
      <div class="d-flex align-items-center">
        <label for="biofixFrom" class="form-label mb-0 me-2">
          <span class="fw-bold text-success">Biofix Date:</span>
          <span class="material-icons info-icon ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="The biofix date is when GDD accumulation begins. This is typically the date of first adult emergence, first egg laying, or another key biological event. Setting this correctly is crucial for accurate predictions.">info</span>
        </label>
        <input type="date" id="biofixFrom" class="form-control w-auto me-2">
        <button type="button" class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#biofixModal">
          <span class="material-icons">help</span> How to Set
        </button>
      </div>
    </div>

    <!-- Apple Scab Info Card (collapsible, only for Apple Scab) -->
    <div id="appleScabInfoCard" class="mb-4" style="display:none;">
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div class="d-flex align-items-center mb-2">
            <span class="material-icons highlight me-2">info</span>
            <span class="fw-bold">Apple Scab (Venturia inaequalis) Ascospore Growing Degree Day Model</span>
            <button class="btn btn-sm btn-outline-secondary ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#appleScabInfoCollapse" aria-expanded="false" aria-controls="appleScabInfoCollapse">
              <span class="material-icons expand-icon collapsed">expand_more</span>
            </button>
          </div>
          <div class="collapse" id="appleScabInfoCollapse">
            <hr class="my-2">
            <div class="text-muted">
              <p>The Apple Scab Degree Day Model is used to predict the ascospore maturation of the Apple Scab fungus, in order to improve pest management decisions.</p>
              <p>For best results, a biofix date should be set at bud-break. The growing degree day model can then be used to predict ascospore maturation.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Map Placeholder -->
    <div class="bg-white p-4 rounded-4 shadow-sm mb-4">
      <h5 class="mb-3">Map View</h5>
      <div id="map" style="height: 300px; width: 100%;"></div>
    </div>

    <!-- Current Growth Stage Card -->
    <div class="mb-4">
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div class="d-flex align-items-center mb-2">
            <span class="material-icons highlight me-2">show_chart</span>
            <span class="fw-bold">Current Growth Stage</span>
          </div>
          <div class="fs-4 fw-bold" id="growthStageTitle">7% Ascospore Maturation</div>
          <hr class="my-2">
          <div><b>Today's GDD:</b> <span id="todaysGddValue">15</span></div>
          <div><b>Accumulated GDD:</b> <span id="accumulatedGddValue">250</span></div>
          <div><b>GDD:</b> <span id="growthStageRange">201 - 300</span></div>
          <div><b id="growthStagePestLabel">Fungus Ascospore:</b> <span id="growthStageDesc">7% Ascospore Maturation.</span></div>
        </div>
      </div>
    </div>

    <!-- All Growth Stages Section -->
    <div class="mb-4">
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div class="d-flex align-items-center mb-2">
            <span class="material-icons highlight me-2">list</span>
            <span class="fw-bold">All Growth Stages</span>
            <button class="btn btn-sm btn-outline-secondary ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#growthStagesCollapse" aria-expanded="false" aria-controls="growthStagesCollapse">
              <span class="material-icons expand-icon">expand_more</span>
            </button>
          </div>
          <div class="collapse" id="growthStagesCollapse">
            <div id="allGrowthStages">
              <!-- Growth stages will be inserted here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Risk Level Card -->
    <div class="mb-4">
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div class="d-flex align-items-center mb-2">
            <span class="material-icons highlight me-2">warning</span>
            <span class="fw-bold">Risk Level</span>
          </div>
          <div class="fs-4 fw-bold" id="riskLevelValue">Low</div>
          <hr class="my-2">
          <div id="riskLevelDesc">Conditions are not favorable for pest/disease activity.</div>
        </div>
      </div>
    </div>

    <!-- Continuous Monitoring Reminder -->
    <div class="mb-4">
      <div class="card border-0 shadow-sm rounded-4" style="border-left: 4px solid #8bb439 !important;">
        <div class="card-body">
          <div class="d-flex align-items-start">
            <span class="material-icons highlight me-2 mt-1">monitoring</span>
            <div>
              <h6 class="fw-bold mb-2">Continuous Monitoring is Essential</h6>
              <p class="text-muted small mb-2">
                <strong>Remember:</strong> GDD predictions are tools to guide your monitoring, but they cannot replace regular field scouting and observation. Always verify predictions with actual field conditions.
              </p>
              <div class="row">
                <div class="col-md-6">
                  <h6 class="fw-bold text-success small">What to Monitor:</h6>
                  <ul class="text-muted small mb-0">
                    <li>Visual signs of pest/disease presence</li>
                    <li>Population levels and distribution</li>
                    <li>Plant damage symptoms</li>
                    <li>Weather conditions and microclimate</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h6 class="fw-bold text-success small">Monitoring Frequency:</h6>
                  <ul class="text-muted small mb-0">
                    <li>Weekly during growing season</li>
                    <li>More frequent during high-risk periods</li>
                    <li>After weather events</li>
                    <li>Before and after treatments</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Biological Recommendations Section -->
    <div class="mb-4">
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body">
          <div class="d-flex align-items-center mb-2">
            <span class="material-icons highlight me-2">eco</span>
            <span class="fw-bold">Biological Recommendations</span>
          </div>
          <div class="alert alert-warning mb-3">
            <div class="d-flex align-items-start">
              <span class="material-icons me-2">warning</span>
              <div class="small">
                <strong>Note:</strong> These recommendations are based on the current stage of the selected pest/disease. Recommendations may vary for different stages of development.
              </div>
            </div>
          </div>
          <div id="bioRecs">
            <!-- Recommendations will be inserted here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Charts stacked vertically -->
    <div class="mb-4">
      <div class="bg-white p-3 rounded-4 shadow-sm mb-4">
        <h6 class="mb-2">Accumulated GDD
          <span class="material-icons info-icon ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Shows the total accumulated Growing Degree Days (GDD) over the selected period, based on the chosen base temperature and biofix date.">info</span>
        </h6>
        <canvas id="accumGddChart" height="120"></canvas>
      </div>
    </div>
  </div>

  <!-- Bootstrap, jQuery, Chart.js, Material Icons, and Leaflet -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // --- GDD Calculation from real weather data ---
    async function fetchWeatherEOSDA(from, to) {
      const date_from = from + 'T00:00';
      const date_to = to + 'T00:00';
      const res = await fetch('http://localhost:3001/fetch-weather', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ date_from, date_to })
      });
      const data = await res.json();
      if (!data.success) throw new Error(data.error || 'Failed to fetch EOSDA weather');
      return data.data;
    }

    // Calculate daily and accumulated GDD from weather data
    function calculateGDDSeries(weatherData, base) {
      let accum = 0;
      return weatherData.map(d => {
        // Use air temperature min/max (in °C)
        const tmin = d.Temp_air_min;
        const tmax = d.Temp_air_max;
        let gdd = ((tmax + tmin) / 2) - base;
        if (gdd < 0) gdd = 0;
        accum += gdd;
        return {
          date: d.Date,
          gdd: Math.round(accum),
          dailyGdd: Math.round(gdd)
        };
      });
    }

    let allData = [];
    let accumGddChart;

    function updateAccumGddChart(filteredData) {
      accumGddChart.data.labels = filteredData.map(d => d.date);
      accumGddChart.data.datasets[0].data = filteredData.map(d => d.gdd);
      accumGddChart.update();
    }

    async function loadAndDisplayGDD() {
      const today = new Date();
      const prior = new Date();
      prior.setDate(today.getDate() - 29);
      const startDate = prior.toISOString().split('T')[0];
      const endDate = today.toISOString().split('T')[0];
      try {
        const weather = await fetchWeatherEOSDA(startDate, endDate);
        const base = 10; // Hardcoded to 10°C
        allData = calculateGDDSeries(weather, base);
        updateAccumGddChart(allData);
        // Update growth stage and risk cards
        updateGrowthStageCard();
        updateRiskLevelCard();
        updateAllGrowthStages();
      } catch (e) {
        alert('Failed to load weather data: ' + e.message);
      }
    }

    $(function() {
      // Initialize Accumulated GDD chart
      accumGddChart = new Chart(document.getElementById('accumGddChart').getContext('2d'), {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Accumulated GDD', data: [], borderColor: '#8bb439', backgroundColor: 'rgba(139,180,57,0.1)', tension: 0.3, fill: true }] },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { display: true, title: { display: true, text: 'Date' } }, y: { display: true, title: { display: true, text: 'Accumulated GDD' } } } }
      });
      loadAndDisplayGDD();

      // Leaflet Map
      var map = L.map('map').setView([-26.4962, 152.9150], 18); // Centered on Yandina Farm
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 19,
        attribution: 'Tiles © Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
      }).addTo(map);
      // Yandina Farm polygon coordinates (longitude, latitude)
      const yandinaCoords = [
        [-26.49630785386763, 152.9148355104133],
        [-26.49644491790693, 152.9149951437186],
        [-26.49643498282219, 152.9150826047683],
        [-26.49647654096426, 152.915136003929],
        [-26.49641027369633, 152.9151679717066],
        [-26.4963066956674, 152.9151522879532],
        [-26.49617943071427, 152.9151405649811],
        [-26.49603918146022, 152.9151330645278],
        [-26.49598117140157, 152.9150405267262],
        [-26.49619458038391, 152.9149028386955],
        [-26.49630785386763, 152.9148355104133]
      ];
      L.polygon(yandinaCoords, {color: '#8bb439', fillOpacity: 0.3})
        .addTo(map)
        .bindPopup('Yandina Farm')
        .openPopup();
      map.fitBounds(yandinaCoords);

      // Enable Bootstrap tooltips
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });

      // Handle expand/collapse button icon rotation
      $('#growthStagesCollapse').on('show.bs.collapse', function () {
        $('.expand-icon').removeClass('collapsed');
      });
      $('#growthStagesCollapse').on('hide.bs.collapse', function () {
        $('.expand-icon').addClass('collapsed');
      });

      // Handle introduction section expand/collapse button icon rotation
      $('#introCollapse').on('show.bs.collapse', function () {
        $(this).prev().find('.expand-icon').removeClass('collapsed');
      });
      $('#introCollapse').on('hide.bs.collapse', function () {
        $(this).prev().find('.expand-icon').addClass('collapsed');
      });

      // Show Apple Scab info card only when Apple Scab is selected
      function toggleAppleScabInfoCard() {
        if ($('#pestSelect').val() === 'ascospore') {
          $('#appleScabInfoCard').show();
        } else {
          $('#appleScabInfoCard').hide();
          $('#appleScabInfoCollapse').collapse('hide');
        }
      }
      $('#pestSelect').on('change', toggleAppleScabInfoCard);
      toggleAppleScabInfoCard();

      // Handle expand/collapse icon rotation for Apple Scab info card
      $('#appleScabInfoCollapse').on('show.bs.collapse', function () {
        $('#appleScabInfoCard .expand-icon').removeClass('collapsed');
      });
      $('#appleScabInfoCollapse').on('hide.bs.collapse', function () {
        $('#appleScabInfoCard .expand-icon').addClass('collapsed');
      });
    });

    // --- GDD Growth Stage Mapping (mock) ---
    const gddStages = {
      ascospore: {
        10: [
          { min: 0, max: 200, title: 'Dormant', desc: 'No ascospore maturation.' },
          { min: 201, max: 300, title: '7% Ascospore Maturation', desc: '7% Ascospore Maturation.' },
          { min: 301, max: 500, title: '20% Ascospore Maturation', desc: '20% Ascospore Maturation.' },
          { min: 501, max: 800, title: '50% Ascospore Maturation', desc: '50% Ascospore Maturation.' },
          { min: 801, max: 2000, title: 'Mature', desc: 'Full ascospore maturity.' }
        ]
      },
      other: {
        10: [
          { min: 0, max: 400, title: 'Egg Laying', desc: 'Pest is laying eggs.' },
          { min: 401, max: 900, title: 'Larval Stage', desc: 'Larvae are active.' },
          { min: 901, max: 2000, title: 'Adult', desc: 'Adults present.' }
        ]
      }
    };

    function updateGrowthStageCard() {
      const base = 10; // Hardcoded to 10°C
      const pest = $('#pestSelect').val();
      // Use current GDD value from the calculated data
      const currentGdd = allData[allData.length - 1]?.gdd || 0;
      const todaysGdd = allData[allData.length - 1]?.dailyGdd || 0;
      const stages = gddStages[pest][base];
      let stage = stages[0];
      for (let s of stages) {
        if (currentGdd >= s.min && currentGdd <= s.max) { stage = s; break; }
      }
      $('#growthStageTitle').text(stage.title);
      $('#todaysGddValue').text(todaysGdd || 'N/A');
      $('#accumulatedGddValue').text(currentGdd || 'N/A');
      $('#growthStageRange').text(`${stage.min} - ${stage.max}`);
      $('#growthStagePestLabel').text($('#pestSelect option:selected').text() + ':');
      $('#growthStageDesc').text(stage.desc);
    }

    function updateAllGrowthStages() {
      const base = 10; // Hardcoded to 10°C
      const pest = $('#pestSelect').val();
      const currentGdd = allData[allData.length - 1]?.gdd || 0;
      const stages = gddStages[pest][base];
      
      let html = '';
      stages.forEach((stage, index) => {
        let status = '';
        let statusClass = '';
        
        if (currentGdd < stage.min) {
          status = 'Upcoming';
          statusClass = 'text-muted';
        } else if (currentGdd >= stage.min && currentGdd <= stage.max) {
          status = 'Current';
          statusClass = 'text-success fw-bold';
        } else {
          status = 'Completed';
          statusClass = 'text-secondary';
        }
        
        html += `
          <div class="border-bottom pb-2 mb-2 ${currentGdd >= stage.min && currentGdd <= stage.max ? 'bg-light rounded p-2' : ''}">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="mb-1">${stage.title}</h6>
                <p class="mb-1 text-muted small">${stage.desc}</p>
                <span class="badge bg-secondary">GDD: ${stage.min} - ${stage.max}</span>
              </div>
              <span class="badge ${statusClass === 'text-success fw-bold' ? 'bg-success' : statusClass === 'text-secondary' ? 'bg-secondary' : 'bg-light text-dark'}">${status}</span>
            </div>
          </div>
        `;
      });
      
      $('#allGrowthStages').html(html);
    }

    // Listen to filter changes
    $('#pestSelect').on('change', function() {
      updateGrowthStageCard();
      updateAllGrowthStages();
    });
    // Also update after mock GDD values are set
    $(function() {
      updateGrowthStageCard();
      updateAllGrowthStages();
    });

    // --- Risk Level logic (general) ---
    function updateRiskLevelCard() {
      const base = 10; // Hardcoded to 10°C
      const pest = $('#pestSelect').val();
      const gdd = allData[allData.length - 1]?.gdd || 0;
      let risk = 'Low', desc = 'Conditions are not favorable for pest/disease activity.';
      
      // General risk assessment based on GDD accumulation
      if (gdd > 1000) { 
        risk = 'High'; 
        desc = 'High risk for pest/disease development and population growth. Consider immediate management actions.'; 
      }
      else if (gdd > 500) { 
        risk = 'Moderate'; 
        desc = 'Moderate risk for pest/disease activity. Monitor closely and prepare for management if needed.'; 
      }
      else { 
        risk = 'Low'; 
        desc = 'Conditions are not favorable for pest/disease activity. Continue monitoring.'; 
      }
      
      $('#riskLevelValue').text(risk);
      $('#riskLevelDesc').text(desc);
    }
    $('#pestSelect').on('change', function() {
      updateRiskLevelCard();
    });
    $(function() {
      updateRiskLevelCard();
    });

    // --- NTS Product Recommendations Mapping (sample) ---
    const ntsProducts = {
      ascospore: [
        {
          name: 'NTS BAM™ (Biologically Activated Minerals)',
          desc: 'A microbial inoculant to support plant health and resilience against fungal pathogens.',
          link: 'https://www.nutri-tech.com.au/products/bam-biologically-activated-minerals'
        },
        {
          name: 'NTS Triple Ten™',
          desc: 'A broad-spectrum liquid fertiliser with trace elements and biologicals for plant vigor.',
          link: 'https://www.nutri-tech.com.au/products/triple-ten'
        }
      ],
      other: [
        {
          name: 'NTS K-Carb™',
          desc: 'A potassium carbonate solution for disease suppression and improved plant health.',
          link: 'https://www.nutri-tech.com.au/products/k-carb'
        }
      ]
    };

    function updateBioRecs() {
      const pest = $('#pestSelect').val();
      const recs = ntsProducts[pest] || [];
      let html = '';
      if (recs.length === 0) {
        html = '<div class="text-muted">No recommendations available for this pest/disease.</div>';
      } else {
        html = recs.map(prod => `
          <div class="mb-2">
            <b>${prod.name}</b><br>
            <span>${prod.desc}</span><br>
            <a href="${prod.link}" class="btn btn-sm btn-outline-success mt-1" target="_blank">More Information <span class="material-icons" style="font-size:1em;vertical-align:middle;">open_in_new</span></a>
          </div>
        `).join('');
      }
      $('#bioRecs').html(html);
    }
    $('#pestSelect').on('change', updateBioRecs);
    $(function() { updateBioRecs(); });
  </script>
</body>
</html> 